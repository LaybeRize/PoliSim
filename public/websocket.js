!function(){var u;function s(e){return null!=u.getInternalData(e).webSocket}function l(e){if(!u.bodyContains(e)){e=u.getInternalData(e);return e.webSocket?(e.webSocket.close(),1):void 0}}function t(e){e=new WebSocket(e,[]);return e.binaryType=htmx.config.wsBinaryType,e}function i(e,t){var n=[];return(u.hasAttribute(e,t)||u.hasAttribute(e,"hx-ws"))&&n.push(e),e.querySelectorAll("["+t+"], [data-"+t+"], [data-hx-ws], [hx-ws]").forEach(function(e){n.push(e)}),n}function o(e,t){if(e)for(var n=0;n<e.length;n++)t(e[n])}htmx.defineExtension("ws",{init:function(e){u=e,htmx.createWebSocket||(htmx.createWebSocket=t),htmx.config.wsReconnectDelay||(htmx.config.wsReconnectDelay="full-jitter")},onEvent:function(e,t){var n=t.target||t.detail.elt;switch(e){case"htmx:beforeCleanupElement":var r=u.getInternalData(n);return void(r.webSocket&&r.webSocket.close());case"htmx:beforeProcessNode":o(i(n,"ws-connect"),function(e){!function(i){if(u.bodyContains(i)){var e=u.getAttributeValue(i,"ws-connect");if(null==e||""===e){var t=function(e){e=u.getAttributeValue(e,"hx-ws");if(e)for(var t=e.trim().split(/\s+/),n=0;n<t.length;n++){var r=t[n].split(/:(.+)/);if("connect"===r[0])return r[1]}}(i);if(null==t)return;e=t}0===e.indexOf("/")&&(t=location.hostname+(location.port?":"+location.port:""),"https:"===location.protocol?e="wss://"+t+e:"http:"===location.protocol&&(e="ws://"+t+e));var o=function(r,t){var s={socket:null,messageQueue:[],retryCount:0,events:{},addEventListener:function(e,t){this.socket&&this.socket.addEventListener(e,t),this.events[e]||(this.events[e]=[]),this.events[e].push(t)},sendImmediately:function(e,t){this.socket||u.triggerErrorEvent(),t&&!u.triggerEvent(t,"htmx:wsBeforeSend",{message:e,socketWrapper:this.publicInterface})||(this.socket.send(e),t&&u.triggerEvent(t,"htmx:wsAfterSend",{message:e,socketWrapper:this.publicInterface}))},send:function(e,t){this.socket.readyState!==this.socket.OPEN?this.messageQueue.push({message:e,sendElt:t}):this.sendImmediately(e,t)},handleQueuedMessages:function(){for(;0<this.messageQueue.length;){var e=this.messageQueue[0];if(this.socket.readyState!==this.socket.OPEN)break;this.sendImmediately(e.message,e.sendElt),this.messageQueue.shift()}},init:function(){this.socket&&this.socket.readyState===this.socket.OPEN&&this.socket.close();var n=t();u.triggerEvent(r,"htmx:wsConnecting",{event:{type:"connecting"}}),(this.socket=n).onopen=function(e){s.retryCount=0,u.triggerEvent(r,"htmx:wsOpen",{event:e,socketWrapper:s.publicInterface}),s.handleQueuedMessages()},n.onclose=function(e){var t;!l(r)&&0<=[1006,1012,1013].indexOf(e.code)&&(t=function(e){var t=htmx.config.wsReconnectDelay;if("function"==typeof t)return t(e);if("full-jitter"===t){e=Math.min(e,6);return 1e3*Math.pow(2,e)*Math.random()}logError('htmx.config.wsReconnectDelay must either be a function or the string "full-jitter"')}(s.retryCount),setTimeout(function(){s.retryCount+=1,s.init()},t)),u.triggerEvent(r,"htmx:wsClose",{event:e,socketWrapper:s.publicInterface})},n.onerror=function(e){u.triggerErrorEvent(r,"htmx:wsError",{error:e,socketWrapper:s}),l(r)};var e=this.events;Object.keys(e).forEach(function(t){e[t].forEach(function(e){n.addEventListener(t,e)})})},close:function(){this.socket.close()}};return s.init(),s.publicInterface={send:s.send.bind(s),sendImmediately:s.sendImmediately.bind(s),reconnect:s.init.bind(s),queue:s.messageQueue},s}(i,function(){return htmx.createWebSocket(e)});o.addEventListener("message",function(e){if(!l(i)){var t=e.data;if(u.triggerEvent(i,"htmx:wsBeforeMessage",{message:t,socketWrapper:o.publicInterface})){u.withExtensions(i,function(e){t=e.transformResponse(t,null,i)});var n=u.makeSettleInfo(i),e=u.makeFragment(t);if(e.children.length)for(var r=Array.from(e.children),s=0;s<r.length;s++)u.oobSwap(u.getAttributeValue(r[s],"hx-swap-oob")||"true",r[s],n);u.settleImmediately(n.tasks),u.triggerEvent(i,"htmx:wsAfterMessage",{message:t,socketWrapper:o.publicInterface})}}}),u.getInternalData(i).webSocket=o}}(e)}),o(i(n,"ws-send"),function(e){var t;t=e,(e=u.getAttributeValue(t,"hx-ws"))&&"send"!==e||function(a,c){var t=u.getInternalData(c);u.getTriggerSpecs(c).forEach(function(e){u.addTriggerHandler(c,e,t,function(e,t){var n,r,s,i,o;l(a)||(n=u.getInternalData(a).webSocket,r=u.getHeaders(c,u.getTarget(c)),o=(s=u.getInputValues(c,"post")).errors,i=Object.assign({},s.values),s=u.getExpressionVars(c),i=u.mergeObjects(i,s),s={parameters:u.filterValues(i,c),unfilteredParameters:i,headers:r,errors:o,triggeringEvent:t,messageBody:void 0,socketWrapper:n.publicInterface},u.triggerEvent(e,"htmx:wsConfigSend",s)&&(o&&0<o.length?u.triggerEvent(e,"htmx:validation:halted",o):(void 0===(i=s.messageBody)&&(o=Object.assign({},s.parameters),s.headers&&(o.HEADERS=r),i=JSON.stringify(o)),n.send(i,e),t&&u.shouldCancel(t,e)&&t.preventDefault())))})})}(u.getClosestMatch(t,s),t)})}}})}();